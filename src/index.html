<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <link rel="icon" href="/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>doragonabe site</title>

    <meta content="noindex,nofollow,noarchive" name="robots">
    <meta name="referrer" content="no-referrer">

    <link href="/assets/css/reset.css" rel="stylesheet">

    <script src="/assets/js/jquery-3.6.0.min.js"></script>
    <script src="/assets/js/jquery-migrate-3.3.2.min.js"></script>

    <link href="/assets/js/mmenu/mmenu.css" rel="stylesheet">

    <link href="/assets/css/style.css" rel="stylesheet">
    <link href="/assets/css/craft.css" rel="stylesheet">

    <!-- 画像ちらつき抑制 -->
    <link rel="preload" href="/assets/images/logo.png" as="image">
    <link rel="preload" href="/assets/images/minecraft1.png" as="image">
    <link rel="preload" href="/assets/images/123_kazari1.png" as="image">
    <link rel="preload" href="/assets/images/arrow1.png" as="image">
    <link rel="preload" href="/assets/images/arrow2.png" as="image">
    <link rel="preload" href="/assets/images/sample1.jpg" as="image">
    <link rel="preload" href="/assets/images/sample2.jpg" as="image">
    <link rel="preload" href="/assets/images/sample2.jpg" as="image">

    <style>
        [v-cloak] {
            display: none;
        }
    </style>

    <script>
      // GitHub Pages での SPA アドレス解決用
      (function() {
        const query = new URLSearchParams(window.location.search);
        if (query.has('p')) {
          const route = decodeURIComponent(query.get('p'));
          window.history.replaceState(null, null, route);
        }
      })();
    </script>

    <script>
      $(function() {
        const header = $('header');
        const sub = $('#sub');

        // window縦サイズ
        const window_height = $(window).height();

        // サイドメニューサイズ
        const sub_height = sub.height() + 40;
        const header_height = header.height();

        if (window_height < sub_height) {
          // windowサイズがメニューより小さい
          sub.removeClass('sticky_top');
          sub.removeClass('sticky_bottom');
        } else {
          // windowサイズがメニューより大きい
          sub.addClass('sticky_top');
          sub.removeClass('sticky_bottom');
        }

        let scroll = 0;
        $(window).on('scroll', function() {
          // サブメニューtopの位置
          const sub_top = sub.offset().top;

          // サブメニューbottomの位置
          const sub_bottom = sub_top + sub.height();

          const scroll_top = $(this).scrollTop();
          const scroll_bottom = scroll_top + window_height;

          // サブメニュー初期位置と現在topの差
          let sub_top_diff = sub_top - header_height - 50;
          if (0 > (sub_top_diff)) {
            sub_top_diff = 0;
          }

          if (scroll_top < scroll) {
            //上スクロールの時の処理
            if (window_height < sub_height) {
              if(sub.offset().top >= scroll_top + 20) {
                if (!sub.hasClass('sticky_top')) {
                    sub.addClass('sticky_top');
                    sub.css('margin-top', '');
                }
              } else {
                if (sub.hasClass('sticky_bottom')) {
                  sub.css('margin-top', sub_top_diff)
                  sub.removeClass('sticky_bottom');
                }
              }
            }
          } else {
            //下スクロールの時の処理
            if (window_height < sub_height) {
              if(sub_top >= scroll_top + 20) {
                // scroll時、windowサイズがメニューより大きい
                if (sub.hasClass('sticky_top')) {
                  sub.removeClass('sticky_top');
                  sub.css('margin-top', sub_top_diff)
                }
              }else{
                // scroll時、windowサイズがメニューより小さい
                if (sub_bottom < scroll_bottom && !sub.hasClass('sticky_bottom')) {
                  // scrollがサインドメニューのbottomを超えた場合
                  sub.removeClass('sticky_top');
                  sub.addClass('sticky_bottom');
                }
              }
            }
          }
          scroll = scroll_top;
        });

        /*
        $(window).resize(function() {
          const sub_height = sub.height() + 40;


          //const header = $('header');
          //const header_height = header.height();

          //console.log(sub.offset().top - header_height - 50);

          //let aaa = sub.offset().top;

          if (window_height < sub_height) {
            sub.addClass('sticky_bottom');
            sub.removeClass('sticky_top');
          } else {
            sub.addClass('sticky_top');
            sub.removeClass('sticky_bottom');
          }
        });
        */
      });
    </script>

    <script src="/assets/js/mmenu/mmenu.js"></script>
    <script>
      $(function() {
          window.mmenu = new Mmenu('#menu', {
            extensions: [
              'position-right',
            ],
          });
        },
      );
    </script>
</head>
<body class="home">
<div id="app" v-cloak></div>

<script type="module" src="/main.ts"></script>
</body>
</html>
